{"remainingRequest":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\wamp64\\www\\crm\\frontend\\src\\components\\users\\kanbanBoard.vue?vue&type=style&index=0&id=37eb6488&lang=css","dependencies":[{"path":"C:\\wamp64\\www\\crm\\frontend\\src\\components\\users\\kanbanBoard.vue","mtime":1675192891451},{"path":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1668443312723},{"path":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1668443313146},{"path":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1668443312991},{"path":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668443304858},{"path":"C:\\wamp64\\www\\crm\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1668443313146}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouc2ltcGxlYmFyLXNjcm9sbGJhcjpiZWZvcmUgew0KICBvcGFjaXR5OiAwLjUgIWltcG9ydGFudDsNCn0NCg=="},{"version":3,"sources":["C:\\wamp64\\www\\crm\\frontend\\src\\components\\users\\kanbanBoard.vue"],"names":[],"mappings":";AAmVA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EAC1B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACzB","file":"C:/wamp64/www/crm/frontend/src/components/users/kanbanBoard.vue","sourceRoot":"","sourcesContent":["<script>\r\n\r\nimport {VueDraggableNext} from \"vue-draggable-next\";\r\nimport {AlignLeftIcon, EyeIcon} from \"@zhuowenli/vue-feather-icons\";\r\nimport moment from \"moment\";\r\nimport axios from \"axios\";\r\nimport Swal from \"sweetalert2\";\r\nimport { ref } from \"vue\";\r\n// import { store } from '@/state/store'\r\nimport { mapState } from 'vuex';\r\n\r\nexport default {\r\n  name: 'kanbanBoard',\r\n  props:['list'],\r\n  data() {\r\n    return {\r\n      notes: [],\r\n      chatMessages: [],\r\n      perPage: 100,\r\n      listToUpdate: '',\r\n    };\r\n  },\r\n  components: {\r\n    draggable: VueDraggableNext,\r\n    EyeIcon,\r\n    AlignLeftIcon,\r\n  },\r\n  methods: {\r\n    log (oldList, event) {\r\n      const { removed } = event\r\n\r\n      if(removed) {\r\n        const userID = removed.element.ID;\r\n\r\n        let newList = document.getElementById('statusCard-' + userID).value;\r\n        let cardID = document.getElementById('card-' + userID);\r\n\r\n        if (oldList !== newList) {\r\n\r\n          const pattern = '/client/';\r\n          if(window.location.href.match(pattern)) {\r\n            this.updateClientStatus(cardID, newList, oldList, userID)\r\n            document.getElementById('statusCard-' + userID).value = oldList;\r\n          } else {\r\n            this.updateAgentStatus(cardID, newList, oldList, userID)\r\n            document.getElementById('statusCard-' + userID).value = oldList;\r\n          }\r\n        }\r\n      }\r\n    },\r\n    formatDate: function (date, format) {\r\n      date = moment(date).format(format)\r\n      return date;\r\n    },\r\n    daysFromDate: function (date) {\r\n      let days = ''\r\n      days = moment(date).fromNow();\r\n      return days;\r\n    },\r\n    // printEnd (number, status) {\r\n    //   // var oldList = document.getElementById('statusCard-' + number).value;\r\n    //   // setTimeout(() => {\r\n    //   //   var cardID = document.getElementById('card-' + number);\r\n    //   //   var newList = document.getElementById('statusCard-' + number).value;\r\n    //   //   if (oldList !== newList) {\r\n    //   //     this.updateAgentStatus(cardID, newList, oldList, number)\r\n    //   //     document.getElementById('statusCard-' + number).value = status;\r\n    //   //   }\r\n    //   // }, 300);\r\n    // },\r\n    async updateAgentStatus (item, newList, oldList, agentID) {\r\n\r\n      const data = {\r\n        item: item,\r\n        newList: newList,\r\n        oldList: oldList,\r\n        agentID: agentID,\r\n        userID: localStorage.getItem('id'),\r\n        token: localStorage.getItem('jwt'),\r\n      }\r\n\r\n      await axios\r\n          .put('/api/updateUserStatus', data)\r\n          .then(async response => {\r\n\r\n            if (response) {\r\n\r\n              await Swal.fire({\r\n                position: \"top-end\",\r\n                icon: \"success\",\r\n                title: \"Your work has been saved!\",\r\n                showConfirmButton: false,\r\n                timer: 1000,\r\n              });\r\n\r\n            } else {\r\n              await Swal.fire({\r\n                position: \"bottom-end\",\r\n                icon: 'error',\r\n                title: \"Something wrong happens!\",\r\n                showConfirmButton: false,\r\n                timer: 5000,\r\n              });\r\n            }\r\n\r\n          }).catch(async error => {\r\n            if (error.response) {\r\n              let list = '';\r\n              for (const property in error.response.data) {\r\n                this.errors.push(`${property}: ${error.response.data[property]}`)\r\n                list += '\\n' + '<b>' + error.response.data[property] + '</b>';\r\n              }\r\n\r\n              await Swal.fire({\r\n                position: \"top-end\",\r\n                icon: \"success\",\r\n                title: \"Please check the following: \" + list,\r\n                showConfirmButton: false,\r\n                timer: 5000,\r\n              });\r\n\r\n            } else if (error.message) {\r\n              this.errors.push('Something was wrong, please contact your SysAdmin.')\r\n            }\r\n          })\r\n    },\r\n    async updateClientStatus (item, newList, oldList, clientID) {\r\n\r\n      const data = {\r\n        item: item,\r\n        newList: newList,\r\n        oldList: oldList,\r\n        clientID: clientID,\r\n        userID: localStorage.getItem('id'),\r\n        token: localStorage.getItem('jwt'),\r\n      }\r\n\r\n      await axios\r\n          .put('/api/client/updateClientStatus', data)\r\n          .then(async response => {\r\n\r\n            if (response) {\r\n\r\n              await Swal.fire({\r\n                position: \"top-end\",\r\n                icon: \"success\",\r\n                title: \"Your work has been saved!\",\r\n                showConfirmButton: false,\r\n                timer: 1000,\r\n              });\r\n\r\n            } else {\r\n              await Swal.fire({\r\n                position: \"bottom-end\",\r\n                icon: 'error',\r\n                title: \"Something wrong happens!\",\r\n                showConfirmButton: false,\r\n                timer: 5000,\r\n              });\r\n            }\r\n\r\n          }).catch(async error => {\r\n            if (error.response) {\r\n              let list = '';\r\n              for (const property in error.response.data) {\r\n                this.errors.push(`${property}: ${error.response.data[property]}`)\r\n                list += '\\n' + '<b>' + error.response.data[property] + '</b>';\r\n              }\r\n\r\n              await Swal.fire({\r\n                position: \"top-end\",\r\n                icon: \"success\",\r\n                title: \"Please check the following: \" + list,\r\n                showConfirmButton: false,\r\n                timer: 5000,\r\n              });\r\n\r\n            } else if (error.message) {\r\n              this.errors.push('Something was wrong, please contact your SysAdmin.')\r\n            }\r\n          })\r\n    },\r\n    async getUserInfo (id) {\r\n      // document.getElementById('edit-btn').style.display='block';\r\n      // document.getElementById('add-btn').style.display='none'\r\n      // document.getElementById('agentModalLabel').innerHTML=\"Edit Agent\"\r\n\r\n      const data = {\r\n        token: localStorage.getItem('jwt'),\r\n        ID: id\r\n      }\r\n\r\n      let agentInfo;\r\n\r\n      await axios\r\n          .post('/api/getUser', data)\r\n          .then(response => {\r\n            agentInfo = response.data\r\n            this.$emit('userData', agentInfo);\r\n            localStorage.setItem('selectedUser', agentInfo.ID)\r\n            localStorage.setItem('selectedUserName', agentInfo.firstName + ' ' + agentInfo.lastName)\r\n          })\r\n          .catch(error => {\r\n            if (error.response) {\r\n\r\n              if(error.response.data.detail === 'Your session is expired!'){\r\n                this.$router.push('logout')\r\n              }\r\n              Swal.fire(\"Oops!\", \"Something was wrong, please contact your SysAdmin.\", \"error\")\r\n            }\r\n          })\r\n    },\r\n    async getClientInfo (id) {\r\n\r\n      const data = {\r\n        token: localStorage.getItem('jwt'),\r\n        ID: id\r\n      }\r\n\r\n      let clientInfo;\r\n\r\n      await axios\r\n          .post('/api/client/getClient', data)\r\n          .then(response => {\r\n            clientInfo = response.data\r\n            this.$emit('userData', clientInfo);\r\n            localStorage.setItem('selectedUser', clientInfo.ID)\r\n            localStorage.setItem('selectedUserName', clientInfo.firstName + ' ' + clientInfo.lastName)\r\n          })\r\n          .catch(error => {\r\n            if (error.response) {\r\n              Swal.fire(\"Oops!\", \"Something was wrong, please contact your SysAdmin.\", \"error\")\r\n            }\r\n          })\r\n    },\r\n    async getConversation() {\r\n\r\n      const data = {\r\n        token: localStorage.getItem('jwt'),\r\n        email:  localStorage.getItem('email'),\r\n        userID: localStorage.getItem('id'),\r\n        selectedUser: localStorage.getItem('selectedUser')\r\n      }\r\n\r\n      await axios\r\n          .post('/api/comm/getSMSConversation', data)\r\n          .then(async response => {\r\n            this.chatMessages = response.data;\r\n            this.$emit('setMessages', response.data)\r\n\r\n            // this.chatMessagesData.push({\r\n            //   align: \"right\",\r\n            //   name: localStorage.getItem('firstName') + ' ' + localStorage.getItem('lastname'),\r\n            //   message,\r\n            //   time: currentDate.getHours() + \":\" + currentDate.getMinutes(),\r\n            // });\r\n          })\r\n          .catch(async error => {\r\n            return error;\r\n          })\r\n    },\r\n    async getData(id){\r\n\r\n      const pattern = '/client/';\r\n      const pattern2 = '/prospects/';\r\n      if(window.location.href.match(pattern)) {\r\n        document.getElementById('modalTitle').innerHTML = 'Client Card'\r\n        await this.getClientInfo(id);\r\n        await this.getNotes(id);\r\n      } else if(window.location.href.match(pattern2)){\r\n        document.getElementById('modalTitle').innerHTML = 'Prospect Card'\r\n        await this.getClientInfo(id);\r\n        await this.getNotes(id);\r\n      } else {\r\n        await this.getUserInfo(id);\r\n        await this.getNotes(id);\r\n      }\r\n      await this.getConversation()\r\n    },\r\n    async getNotes (id) {\r\n      const data = {\r\n        token: localStorage.getItem('jwt'),\r\n        userID: localStorage.getItem('id'),\r\n        agentID: id,\r\n        clientID: id,\r\n      }\r\n\r\n      const pattern = '/client/';\r\n      const pattern2 = '/prospects/';\r\n      let url = '';\r\n      if(window.location.href.match(pattern)) {\r\n        url = '/api/client/getClientNotes';\r\n      } else if(window.location.href.match(pattern2)){\r\n        url = '/api/client/getClientNotes';\r\n      } else {\r\n        url = '/api/getUserNotes';\r\n      }\r\n\r\n      await axios\r\n          .post(url, data)\r\n          .then(response => {\r\n            this.notes = response.data;\r\n            this.$emit('onFire', response.data)\r\n          })\r\n          .catch(error => {\r\n            if (error.response) {\r\n              Swal.fire(\"Oops!\", \"Status could not be loaded, please contact your SysAdmin.\", \"error\")\r\n            }\r\n          })\r\n    },\r\n    loadMore(listName) {\r\n      this.listToUpdate = listName;\r\n      const listFiltered = this.list.find(o => o.groupName.groupName === listName);\r\n      if (this.perPage > listFiltered.perPage) return;\r\n      listFiltered.groupName.perPage = listFiltered.groupName.perPage + this.perPage;\r\n      listFiltered.groupName.showing = listFiltered.groupName.perPage;\r\n    },\r\n    agentsLoaded(listName) {\r\n      this.listToUpdate = listName;\r\n      const list = this.list.find(o => o.groupName.groupName === listName);\r\n      return list.slice(0, list.groupName.perPage);\r\n    },\r\n\r\n  },\r\n  emits: [\"onFire\", \"userData\", \"setMessages\"],\r\n  setup( props, { emit }) {\r\n    const notify = ref (\"1\")\r\n    const notifyNotes = () => {\r\n      emit('onFire', notify)\r\n    }\r\n    return {notify, notifyNotes}\r\n  },\r\n  computed:\r\n    mapState({\r\n    items: s => s.items.todo,\r\n  }),\r\n}\r\n</script>\r\n<style>\r\n.simplebar-scrollbar:before {\r\n  opacity: 0.5 !important;\r\n}\r\n</style>\r\n<template>\r\n  <div class=\"tasks-board mb-3\" id=\"kanbanboard\">\r\n    <div v-for=\"data in list\"\r\n         :key=\"data.groupName.groupID\">\r\n      <div class=\"col tasks-list\">\r\n        <div class=\"card\">\r\n          <a class=\"card-header bg-soft-primary\" data-bs-toggle=\"collapse\" v-bind:href=\"'#'+data.groupName.groupName\"\r\n             role=\"button\"\r\n             aria-expanded=\"false\" v-bind:aria-controls=\"data.groupName.groupName\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-10\">\r\n                <h5 class=\"card-title text-uppercase fw-semibold mb-1 fs-15\"> {{ data.groupName.statusName }}</h5>\r\n              </div>\r\n              <div class=\"col-md-2\">\r\n                <small class=\"badge bg-success align-bottom ms-1\" style=\"float: right;\">{{\r\n                    data.groupName.showing +'/'+ data.groupName.quantity\r\n                  }}</small>\r\n              </div>\r\n            </div>\r\n<!--            <p class=\"text-muted mb-0\">$708,200 <span class=\"fw-medium\">7 Deals</span></p>-->\r\n          </a>\r\n        </div><!--end card-->\r\n        <div data-simplebar class=\"tasks-wrapper collapse show\" v-bind:id=\"data.groupName.groupName\" v-bind:class=\"[data.groupName.quantity > 0 ? '': 'tasks']\">\r\n          <!-- @drop=\"printEnd(d.ID, data.groupName.groupID)\" -->\r\n          <draggable\r\n              :list=\"data\"\r\n              class=\"dragArea\"\r\n              :group=\"{ name: 'todo' }\"\r\n              @change=\"log(data.groupName.groupID, $event)\"\r\n              animation=\"100\">\r\n            <div class=\"card mb-1\"\r\n                 v-for=\"d in agentsLoaded(data.groupName.groupName)\"\r\n                 :key=\"d.ID\"\r\n                 v-bind:id=\"'card-'+d.ID\" >\r\n              <input type=\"text\" v-bind:value=\"data.groupName.groupID\" v-bind:id=\"'statusCard-'+d.ID\"\r\n                     style=\"display: none\">\r\n              <div class=\"card-body\">\r\n                <div class=\"d-flex align-items-center\">\r\n                  <div class=\"flex-shrink-0\">\r\n                    <img src=\"@/assets/images/users/user-dummy-img.jpg\" alt=\"\" class=\"avatar-xs rounded-circle\"/>\r\n                  </div>\r\n                  <div class=\"flex-grow-1 ms-3\">\r\n                    <h6 class=\"fs-14 mb-1\">{{ d.firstName + ' ' + d.lastName }}</h6>\r\n                    <p class=\"text-muted mb-0\">{{ d.departmentName }} - {{\r\n                        formatDate(d.date_joined, 'MMMM Do YYYY')\r\n                      }}</p>\r\n                  </div>\r\n                </div>\r\n                <table id=\"tab\">\r\n                  <tr>\r\n                    <td>\r\n                      <a data-bs-toggle=\"collapse\" v-bind:href=\"'#leadDiscovered'+d.ID\" role=\"button\"\r\n                         aria-expanded=\"false\" aria-controls=\"leadDiscovered1\" v-bind:id=\"d.ID\"\r\n                         style=\"max-width: 20px;\">\r\n                        <EyeIcon class=\"grayIcon eyeIcon\"></EyeIcon>\r\n                      </a>\r\n                    </td>\r\n                    <td>\r\n                      <a data-bs-toggle=\"collapse\" style=\"max-width: 20px;\">\r\n                        <AlignLeftIcon class=\"grayIcon eyeIcon\"></AlignLeftIcon>\r\n                      </a>\r\n                    </td>\r\n                  </tr>\r\n                </table>\r\n              </div>\r\n              <div class=\"collapse border-top border-top-dashed\" v-bind:id=\"'leadDiscovered'+d.ID\">\r\n                <div class=\"card-body\">\r\n                  <h6 class=\"fs-14 mb-1\">{{ d.departmentName }} <small\r\n                      class=\"badge badge-soft-primary\">{{ daysFromDate(d.createdOn) }}</small></h6>\r\n                  <p class=\"text-muted\"></p>\r\n                  <ul class=\"list-unstyled vstack gap-2 mb-0\">\r\n                    <li>\r\n                      <div class=\"d-flex\">\r\n                        <div class=\"flex-shrink-0 avatar-xxs text-muted\">\r\n                          <i class=\"ri-calendar-2-fill\"></i>\r\n                        </div>\r\n                        <div class=\"flex-grow-1\">\r\n                          <h6 class=\"mb-0\">Interview</h6>\r\n                          <small class=\"text-muted\">{{\r\n                              formatDate(d.interviewDate, 'MMMM Do YYYY, h:mmA')\r\n                            }}</small>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                    <li>\r\n                      <div class=\"d-flex\">\r\n                        <div class=\"flex-shrink-0 avatar-xxs text-muted\">\r\n                          <i class=\"ri-phone-fill\"></i>\r\n                        </div>\r\n                        <div class=\"flex-grow-1\">\r\n                          <h6 class=\"mb-0\">Phone</h6>\r\n                          <small class=\"text-muted\">{{ d.phoneNumber }}</small>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                    <li>\r\n                      <div class=\"d-flex\">\r\n                        <div class=\"flex-shrink-0 avatar-xxs text-muted\">\r\n                          <i class=\"ri-earth-line\"></i>\r\n                        </div>\r\n                        <div class=\"flex-grow-1\">\r\n                          <h6 class=\"mb-0\">Email</h6>\r\n                          <small class=\"text-muted\">{{ d.email }}</small>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n                <div class=\"card-footer hstack gap-2\">\r\n                  <button class=\"btn btn-success btn-sm w-100\" data-bs-toggle=\"modal\" href=\"#agentModal\"\r\n                          data-bs-trigger=\"hover\" data-bs-placement=\"top\" @click=\"getData(d.ID), notifyNotes\"><i\r\n                      class=\"ri-door-open-line align-bottom me-1\"></i> Open\r\n                  </button>\r\n                  <button class=\"btn btn-primary btn-sm w-100\" data-bs-toggle=\"collapse\" v-bind:href=\"'#leadDiscovered'+d.ID\">\r\n                    <i class=\"ri-close-circle-line align-bottom me-1\"></i>\r\n                    Close\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div><!--end card-->\r\n            <div\r\n                class=\"btn-group list-group-item\"\r\n                role=\"group\"\r\n                aria-label=\"Basic example\"\r\n                key=\"footer\"\r\n                v-if=\"data.groupName.quantity > data.groupName.showing\"\r\n            >\r\n              <div class=\"d-grid gap-2\">\r\n                <b-button variant=\"outline-secondary\" class=\"waves-effect waves-light\" @click=\"loadMore(data.groupName.groupName)\">Load More</b-button>\r\n              </div>\r\n            </div>\r\n          </draggable>\r\n        </div>\r\n      </div><!--end col-->\r\n    </div>\r\n  </div>\r\n</template>"]}]}